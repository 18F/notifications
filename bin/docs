#!/bin/bash

function abort() {
  echo $*
  exit 1
}

aglio -i v2_docs.apib -o /tmp/v2_docs.html
if [[ $? != 0 ]]; then
  abort "Failed to generate v2 HTML doc."
fi

git checkout gh-pages
if [[ $? != 0 ]]; then
  abort "Failed to checkout gh-pages git branch."
fi

git pull -r
if [[ $? != 0 ]]; then
  abort "Failed to pull latest gh-pages git branch."
fi

mv /tmp/v2_docs.html index.html
if [[ $? != 0 ]]; then
  abort "Failed to update v2 HTML doc."
fi

git commit -am "Updated version of the v2 API documentation."
if [[ $? != 0 ]]; then
  abort "Failed to commit v2 HTML doc."
fi

git push origin head
if [[ $? != 0 ]]; then
  abort "Failed to push v2 HTML doc."
fi

exit 0
